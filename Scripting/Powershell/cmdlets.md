# Powershell cmdlets

- Add the `[cmdletBinding()]` attribute before the `param()` statement.
- `param()` is required even if there are none
- Provides access to features like common parameters, risk mitigation parameters, and `$PSCmdlet` variable.

```sh
function Say-Hello {
    [cmdletBinding()]
    param()
    write-host "Hello"
}
```

## Common Parameters

| Parameter | DataType | Purpose |
| --------- | -------- | ------- |
| Debug | SwitchParameter | Intended for troubleshooting |
| ErrorAction | Enumeration | What action should take place when an error occurs |
| ErrorVariable | String | Variable to place objects when an error occurs |
| InformationAction | ActionPreference | Break, Suspend, Ignore, Inquire, Continue, Stop, SilentlyContinue (default) |
| InformationVariable | String | All information messages generated by cmdlet |
| OutVariable | String | Variable to place all output objects | 
| OutBuffer | Int32 | Number of objects to store in output buffer before any objects are passed to pipeline |
| Pipeline Variable | String | Value of current pipeline element | 
| Verbose | SwitchParameter | Provides additional information to user |
| WarningAction | Enumeration | Action to be taken when cmdlet writes a warning message |
| WarningVariable | String | Variable containing warning messages |

## Risk Mitigation
When you enable risk mitigation you gain access to the following parameters:

| Parameter Name | Purpose |
| -------------- | ------- |
| SupportsShouldProcess | Enables risk mitigation | 
| ConfirmImpact | Prompt user confirmation based on value of `$ConfirmPreference` Flags code as Low, medium, high | 
| DefaultParameterSetName | Used when PS cannot determine which parameter to use |
| HelpURI | Location of online help |
| SupportsPaging | Adds `-First`, `-Skip` and `-IncludeTotalCount` parameters |
| PositionalBinding | True by default, only used to specifiy `$False` when parameters are NOT positional | 


Risk Mitigation will also enable these 2 parameters :

`-WhatIf` - output the expected code if the function was to run
`-Confirm` - confirm that the code should run

### How to support risk mitigation

1. Set the Impact using `ConfirmImpact = "value"`. A prompt will be shown to the user if this value is greater than or equal to their `$ConfirmPreference` variable. 
2. Surround the risky code in an if statement using `$PSCmdlet.ShouldProcess("target", "action")

```sh
function Test-RiskMitigation {
    [CmdletBinding(
        SupportsShouldProcess
        ConfirmImpact = "High"
    )] 
    param(
        [string] $ProcessName
    )
    if ($PSCmdlet.ShouldProcess("$ProcessName", "Stop Process")) {
       Stop-Process -Name $ProcessName
       write-host "$ProcessName is stopped" -ForegroundColor 'red'
    }
}
```
