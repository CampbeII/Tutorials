function Send-Cookie {
    param(
        [System.Net.Cookie] $old,
        [string] $new,
        [string] $endpoint,
        [Microsoft.Powershell.Commands.WebRequestSession] $session
    )
    $new = [System.Net.Cookie]::new($old.Name, $new)
    $session.Cookies.Add($endpoint, $new)
    write-output $session
    <#
    $Response = Invoke-WebRequest -Uri $endpoint -WebSession $session
    #>
    if ($Response.RawContent -contains 'Cookie') {
        write-host 'COOKIE'
    }
    write-output $Response
}

# First Request
$endpoint = 'http://mercury.picoctf.net:43275/'

$Response = Invoke-WebRequest -Uri $endpoint -SessionVariable session
$cookies = $session.Cookies.GetCookies($endpoint)
$old = $cookies[0]


$chars = [char[]] $old.Value

write-host "Flipping bits on $target..."

$num = $chars.length

# 1 char = 1 byte; 8 bits in byte
$out = for($bit = 0; $bit -le 8; $bit++) {
    for($i = 0; $i -lt $num; $i++) {
        $d = ''
        if ($i -gt 0) {
            $d += ($chars[0..($i-1)] -join '')
        }
        if ($i -lt ($num - 1)) {
            $d += ($chars[($i+1)..($num - 1)] -join '')
        }
        Send-Cookie $old $d $endpoint $session
        exit
    }
}
