using System;
using System.Data.SQLClient;

namespace SQL 
{
    class TestProgram 
    {
        static void Main(string[] args)
        {
            string sqlServer = "dc01.corp1.com";
            string database = "master";

            string conString = "Server = " + sqlServer + "; Database = " + database + "; Integrated Security = True;";
            SqlConnection DB = new SqlConnection(conString);

            try {
                DB.open();
                Console.Write("Success");
            }
            catch {
                Console.Write("Fail");
                Environment.Exit(0);
            }

            // SQL Login Information
            string queryLogin = "SELECT SYSTEM_USER;";
            SqlCommand command = new SqlCommand(queryLogin,DB);
            SqlDataRedaer reader = command.ExecuteReader();
            reader.Read(); 
            Console.WriteLine("Logged in as: " + reader[0]);
            reader.Close();
            
            // User Name
            string queryUser = "SELECT USER_NAME();";
            command = new SqlCommand(queryUser,DB);
            reader = command.ExecuteReader();
            reader.Read();
            Console.WriteLine("Mapped to user" + reader[0]);
            reader.Close();

            // Public Roles
            string queryPublicRole = "SELECT IS_SRVROLEMEMBER('public');";
            command = new SqlCommand(queryPublicRole,DB);
            reader = command.ExecuteReader();
            reader.Read();
            int32 role = int32.Parse(reader[0].ToString());
            if (role == 1) {
                Console.WriteLine("Public");
            }
            else {
                Console.WriteLine("Has non public role");
            }
            reader.Close();

            // Admin Roles
            string queryPublicRole = "SELECT IS_SRVROLEMEMBER('sysadmin');";
            command = new SqlCommand(queryPublicRole,DB);
            reader = command.ExecuteReader();
            reader.Read();
            int32 role = int32.Parse(reader[0].ToString());
            if (role == 1) {
                Console.WriteLine("Admin");
            }
            else {
                Console.WriteLine("Has non admin role");
            }
            reader.Close();


            DB.close();
        }
    }
}
