# New Technology LAN Manager (NTLM)
The suite of security protocols used to authenticae user identities in Active Directory. Authentication is provided by a NetNTLM. 

## NetNTLM can be found in:
- Internally-hosted Exchange servers that expose an Outlook Web App (OWA) login portal.
- RDP service of a server.
- VPN endpoints integrated with AD
- Internet facing web applications 

## How does it work?
- In between client and Active Directory
- All authentication material is forwarded to a domain controller
- Challenge goes to domain controller and if successful authenticates the user
- Application authenticates on behalf of user preventing it from storing credentials

Allows the application to act as a middle-man between client and AD.  All authentication material is forwarded to a Domain controller in the form of a challenge. 

##  NTLM Hashes

### NTLM hash location
In the `SAM Database` stored on the machine or in the domain controller NTDS database.

### NTLM hash structure?
The hash will look something similar to:
```sh
guest:501:aad3b435b51404eeaad3b435b51404ee:3e24dcead23468ce597d6883c576f657:::
```
The first 2 sections are related to the user, the last 2 are the `LM` and `NT` hashes.

| LM | NT |
| -- | -- |
| aad3b435b51404eeaad3b435b51404ee | 3e24dcead23468ce597d6883c576f657 |

### Dumping NTLM hash

Manually:
```sh
C:\> reg.exe save hklm\sam c:\temp\sam.save
C:\> reg.exe save hklm\security c:\temp\security.save
C:\> reg.exe save hklm\system c:\temp\system.save
```
Meterpreter:
```sh
meterpreter > run post/windows/gather/smart_hashdump
```

### NTLM Cracking
You can crack NTLM hashes by gaining access to a privileged user accountand dumping the SAM database.

```sh
john --format=NT --wordlist=rockyou.txt crack.txt
```

Meterpreter:
```sh
use auxiliary/analyze/jtr_crack_fast
```
