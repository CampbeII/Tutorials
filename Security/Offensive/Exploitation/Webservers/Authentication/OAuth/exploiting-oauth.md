# Exploiting OAuth

## Stealing Tokens
If the redirect_uri is not well protected we can exploit it to hijack tokens.

## Example Vulnerability
This vulnerability will assume that you have gained control of a subdomain.

1. Craft an HTML page to trigger the exploit and set the redirect_uri. 
```html
<form action="/oauth/login" method="get">
    <input type="hidden" name="redirect_uri" value="/malicious-endpoint.html">
    <input type="submit" value="Hijack OAuth">
</form>
```

2. Craft the `malicious-endpoint`
```js
<script>
   const params = new URLSearchParams(window.location.search);
   const code = urlParams.get('code');
   document.getElementById('auth_code').innerText = code;
   console.log('Authorization Code:', code);
</script>
```

3. Exchange code for token
Using the stolen authentication code, we can send a request to the `callback` endpoint and receive a valid access token.

## CSRF
The `state` parameter helps protect against cross-site request forgery. If the application uses a predictable value, or omit it completey it is vulnerable.

1. Intercept the authorization request using any network interception tool
2. Capture the `code` parameter and use it generate a valid token.
3. Use it to connect to victim account

## Implicit Grant Flow
In this flow tokens are directly returned to the client via the browser without requiring the intermediary authorization code.  This method is depreacted in oAuth 2.0

### Vulnerablities

1. Exposing access token in URL. Any script on the page can access this URL
2. Inadequate validation of redirect URIs allow for malicious redirects
3. No HTTPS means interception
4. Improper handling of access tokens such as storing in `localStorage` or `sessionStorage`


